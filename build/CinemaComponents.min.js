// Cinema Components v2.4.1 Copyright 2018 Los Alamos National Laboratory
'use strict';(function(){var CINEMA_COMPONENTS={}
if(window.CINEMA_COMPONENTS)
CINEMA_COMPONENTS=window.CINEMA_COMPONENTS;else
window.CINEMA_COMPONENTS=CINEMA_COMPONENTS;CINEMA_COMPONENTS.DATABASE_INCLUDED=true;CINEMA_COMPONENTS.DIMENSION_TYPE=Object.freeze({INTEGER:0,FLOAT:1,STRING:2});CINEMA_COMPONENTS.Database=function(directory,callback,errorCallback){this.directory=directory;this.loaded=false;this.error;this.data=[];this.dimensions=[];this.dimensionTypes={};this.dimensionDomains={};this.hasAxisOrdering=false;this.axisOrderData;var self=this;getAndParseCSV(directory+'/data.csv',function(data_arr){self.error=checkErrors(data_arr);if(self.error){if(errorCallback)
errorCallback();return;}
self.dimensions=data_arr[0];self.data=data_arr.slice(1).map(function(d){var obj={};self.dimensions.forEach(function(p,i){obj[p]=d[i];});return obj;});self.dimensions.forEach(function(d){var val=self.data[0][d];if(!isNaN(val)||val.toUpperCase()==="NAN"){if(isNaN(val)||!Number.isInteger(val))
self.dimensionTypes[d]=CINEMA_COMPONENTS.DIMENSION_TYPE.FLOAT;else
self.dimensionTypes[d]=CINEMA_COMPONENTS.DIMENSION_TYPE.INTEGER;var i;for(i=0;i<self.data.length&&isNaN(self.data[i][d]);i++){}
if(i==self.data.length)
self.dimensionDomains[d]=[0,0]
else{var min=self.data[i][d];var max=self.data[i][d];for(var j=i;j<self.data.length;j++){if(!isNaN(self.data[j][d])){min=Math.min(min,self.data[j][d]);max=Math.max(max,self.data[j][d]);}}
self.dimensionDomains[d]=[min,max];}}
else{self.dimensionTypes[d]=CINEMA_COMPONENTS.DIMENSION_TYPE.STRING;self.dimensionDomains[d]=self.data.map(function(p){return p[d];});}});getAndParseCSV(directory+'/axis_order.csv',function(axis_data_arr){var error=checkAxisDataErrors(axis_data_arr,self.dimensions);if(!error){self.hasAxisOrdering=true;self.axisOrderData=parseAxisOrderData(axis_data_arr);}
else
console.warn("ERROR in axis_order.csv: "+error);self.loaded=true;if(callback)
callback(self);},function(){self.loaded=true;if(callback)
callback(self);});},function(){if(errorCallback)
errorCallback("Error loading data.csv!");});};CINEMA_COMPONENTS.Database.prototype.isStringDimension=function(dimension){return this.dimensionTypes[dimension]===CINEMA_COMPONENTS.DIMENSION_TYPE.STRING;};CINEMA_COMPONENTS.Database.prototype.getSimilar=function(query,threshold){var self=this;var similar=[];this.data.forEach(function(row,index){var dist=0;self.dimensions.forEach(function(d){if(query[d]!==undefined){if(self.isStringDimension(d))
dist+=(row[d]==query[d]?0:1);else{if(isNaN(query[d]))
dist+=(isNaN(row[d])?0:1);else if(row[d]===undefined)
dist+=1;else{var extent=self.dimensionDomains[d];dist+=Math.abs(getNormalizedValue(query[d],extent[0],extent[1])
-
getNormalizedValue(row[d],extent[0],extent[1]));}}}});if(dist<=threshold){similar.push(index);}});return similar;}
var parseAxisOrderData=function(data_arr){var data={};data_arr.slice(1).forEach(function(row){var category=row[0];if(!data[category])
data[category]=[];var value=row[1];data[category].push({name:value});var ordering=data_arr[0].slice(2).map(function(d,i){return[row[i+2],i];}).sort(function(a,b){if(a[0]===undefined){return 1;}
if(b[0]===undefined){return-1;}
return a[0]-b[0];}).map(function(d){return data_arr[0].slice(2)[d[1]];});data[category][data[category].length-1].order=ordering;});return data;}
var getAndParseCSV=function(path,callback,errorCallback){var request=new XMLHttpRequest();request.open("GET",path,true);request.onreadystatechange=function(){if(request.readyState===4){if(request.status===200||(navigator.userAgent.match(/Safari/)&&request.status===0)){var data=parseCSV(request.responseText);if(callback)
callback(data);}
else if(errorCallback){errorCallback();}}}
request.send(null);}
var getNormalizedValue=function(val,min,max){return(max-min==0)?0:((val-min)/(max-min));}
var parseCSV=function(csvText){var csvRegex=/(\,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\,\r\n]*))/gi;var data=[];var matches;if(csvText==="")
return data;while(matches=csvRegex.exec(csvText)){var delimiter=matches[1];var quotedValue=matches[2];var value=matches[3];if(delimiter!=',')
data.push([]);if(quotedValue!==undefined)
data[data.length-1].push(quotedValue.replace(/""/g,"\""));else
data[data.length-1].push(value===""?undefined:value.replace(/""/g,"\""));}
if(data.length>1&&data[data.length-1].length==1&&data[data.length-1][0]===undefined){data=data.slice(0,data.length-1);}
return data;}
var checkErrors=function(data){if(data.length<2)
return"The first and second lines in the file are required.";if(data[0].length<2)
return"The dataset must include at least two dimensions";var emptyValFound=false;for(var i in data[0])
emptyValFound=emptyValFound||(data[0][i]===undefined);for(var i in data[1])
emptyValFound=emptyValFound||(data[1][i]===undefined);if(emptyValFound)
return"Empty values may not occur in the header (first line) or first data row (second line).";var testLength=data[0].length;for(var i in data)
if(data[i].length!=testLength)
return"Each line must have an equal number of comma separated values (columns).";}
var checkAxisDataErrors=function(data,dimensions){if(data.length<2)
return"The first and second lines in the file are required.";var testLength=data[0].length;for(var i in data)
if(data[i].length!=testLength)
return"Each line must have an equal number of comma separated values (columns).";for(var i=2;i<data[0].length;i++){if(!dimensions.includes(data[0][i]))
return"Dimension in axis order file '"+data[0][i]+"' is not valid";}
for(var i=0;i<data.length;i++){if(data[i][0]===undefined)
return"Category cannot be undefined."
if(data[i][1]===undefined)
return"Value cannot be undefined."}
for(var i=1;i<data.length;i++){for(var j=2;j<data[i].length;j++){if(isNaN(data[i][j])&&data[i][j]!==undefined)
return"Values for dimensions cannot be NaN."}}}})();'use strict';(function(){var CINEMA_COMPONENTS={}
if(window.CINEMA_COMPONENTS)
CINEMA_COMPONENTS=window.CINEMA_COMPONENTS;else
window.CINEMA_COMPONENTS=CINEMA_COMPONENTS;if(!CINEMA_COMPONENTS.DATABASE_INCLUDED)
throw new Error("CINEMA_COMPONENTS Component module requires that Database"+" module be included. Please make sure that Database module"+" is included BEFORE Component module");CINEMA_COMPONENTS.COMPONENT_INCLUDED=true;CINEMA_COMPONENTS.Component=function(parent,database,filterRegex){if(this.constructor===CINEMA_COMPONENTS.Component)
throw new Error("Cannot instantiate abstract class 'Component.'"+" Please use a subclass.");this.parent=parent;this.parent.innerHTML='';this.db=database;this.dimensions=[];this.filter=filterRegex;this.dimensions=this.db.dimensions.filter(function(d){return filterRegex?!filterRegex.test(d):true;});this.container=parent.appendChild(document.createElement('div'));this.container.setAttribute('class','CINEMA_COMPONENT');this.container.style.position='absolute';CINEMA_COMPONENTS.Component.prototype.updateSize.call(this);};CINEMA_COMPONENTS.Component.prototype.updateSize=function(){this.margin=this.margin||new CINEMA_COMPONENTS.Margin(0,0,0,0);this.parentRect=this.parent.getBoundingClientRect();this.internalWidth=this.parentRect.width-this.margin.left-this.margin.right;this.internalHeight=this.parentRect.height-this.margin.top-this.margin.bottom;this.container.style.width=this.parentRect.width+'px';this.container.style.height=this.parentRect.height+'px';};CINEMA_COMPONENTS.Component.prototype.destroy=function(){d3.select(this.container).remove();};CINEMA_COMPONENTS.Margin=function(top,right,bottom,left){this.top=top;this.right=right;this.bottom=bottom;this.left=left;}
CINEMA_COMPONENTS.ExtraData=function(data,style){this.data=data;this.style=style;}})();'use strict';(function(){var CINEMA_COMPONENTS={}
if(window.CINEMA_COMPONENTS)
CINEMA_COMPONENTS=window.CINEMA_COMPONENTS;else
window.CINEMA_COMPONENTS=CINEMA_COMPONENTS;if(!CINEMA_COMPONENTS.COMPONENT_INCLUDED)
throw new Error("CINEMA_COMPONENTS Glyph module requires that Component"+" module be included. Please make sure that Component module"+" is included BEFORE Glyph module");if(!window.d3){throw new Error("CINEMA_COMPONENTS Glyph module requires that"+" d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the"+" the Glyph module");}
CINEMA_COMPONENTS.GLYPH_INCLUDED=true;var RADTODEG=(180/Math.PI),DEGTORAD=(Math.PI/180);CINEMA_COMPONENTS.Glyph=function(parent,database,filterRegex){var self=this;this.margin=new CINEMA_COMPONENTS.Margin(50,50,50,50);this.innerMargin;this.radius;CINEMA_COMPONENTS.Component.call(this,parent,database,filterRegex);this.radius=Math.min(this.internalHeight,this.internalWidth)/2;this.innerMargin=this.radius/11;this.selected=0;this.rotation=d3.scalePoint().domain(this.dimensions).range([0,Math.PI*2-Math.PI*2/(this.dimensions.length+1)]);this.scales={};this.dimensions.forEach(function(d){if(self.db.isStringDimension(d))
self.scales[d]=d3.scalePoint().domain(self.db.dimensionDomains[d]).range([self.radius-self.innerMargin,0]);else
self.scales[d]=d3.scaleLinear().domain(self.db.dimensionDomains[d]).range([self.radius-self.innerMargin,0]);});d3.select(this.container).classed('GLYPH',true);this.svg=d3.select(this.container).append('svg').attr('class','glyphChart').attr('viewBox',(-this.margin.right)+' '+(-this.margin.top)+' '+
(this.parentRect.width)+' '+
(this.parentRect.height)).attr('preserveAspectRatio','none').attr('width','100%').attr('height','100%');this.path=this.svg.append('path').classed('glyph',true);this.labels=self.svg.append('g').classed('labels',true).selectAll('g.label').data(this.dimensions).enter().append('g').classed('label',true).attr('transform',function(d){return self.getAxisTransform(d);});this.labels.append('text').style('text-anchor','middle').text(function(d){return d;}).attr('transform',function(d){return"translate(0 -15) "
+"rotate("+self.getTextRotation(d)+")";});this.axisContainer=this.svg.append('g').classed('axisContainer',true);this.axes=this.axisContainer.selectAll('.axisGroup').data(this.dimensions).enter().append('g').classed('axisGroup',true).attr('transform',function(d){return self.getAxisTransform(d);});this.axes.append('g').classed('axis',true).each(function(d){d3.select(this).call(d3.axisLeft().scale(self.scales[d]));d3.select(this).selectAll('text').style('text-anchor','end').attr('transform',"rotate("+self.getTextRotation(d)+" -15 0)");});this.redraw();}
CINEMA_COMPONENTS.Glyph.prototype=Object.create(CINEMA_COMPONENTS.Component.prototype);CINEMA_COMPONENTS.Glyph.prototype.constructor=CINEMA_COMPONENTS.Glyph;CINEMA_COMPONENTS.Glyph.prototype.getPath=function(p){var self=this;var path;var startPoint;this.dimensions.forEach(function(d,i){var point=self.getPoint(d,p);if(i==0){startPoint=point;path="M "+point.x+" "+point.y+" "}
else if(i==self.dimensions.length-1){path+="L "+point.x+" "+point.y+" "+"L "+startPoint.x+" "+startPoint.y;}
else{path+="L "+point.x+" "+point.y+" ";}});return path;}
CINEMA_COMPONENTS.Glyph.prototype.getPoint=function(d,p){if(isNaN(p[d]))
return{x:this.radius,y:this.radius};var len=this.radius-this.scales[d](p[d]);var rot=this.rotation(d)-Math.PI/2;var x=Math.cos(rot)*len;var y=Math.sin(rot)*len;return{x:x+this.radius,y:y+this.radius};}
CINEMA_COMPONENTS.Glyph.prototype.updateSize=function(){var self=this;CINEMA_COMPONENTS.Component.prototype.updateSize.call(this);this.radius=Math.min(this.internalHeight,this.internalWidth)/2;this.innerMargin=this.radius/11;this.svg.attr('viewBox',(-this.margin.right)+' '+(-this.margin.top)+' '+
(this.parentRect.width)+' '+
(this.parentRect.height))
this.dimensions.forEach(function(d){self.scales[d].range([self.radius-self.innerMargin,0]);});this.axes.attr('transform',function(d){return self.getAxisTransform(d);}).each(function(d){d3.select(this).call(d3.axisLeft().scale(self.scales[d]));});this.labels.attr('transform',function(d){return self.getAxisTransform(d);});this.path.attr('d',function(d){return self.getPath(self.db.data[d]);});};CINEMA_COMPONENTS.Glyph.prototype.setSelected=function(index){this.selected=index;this.redraw();};CINEMA_COMPONENTS.Glyph.prototype.redraw=function(){var self=this;this.path.datum(this.selected).transition(1000).attr('d',function(d){return self.getPath(self.db.data[d]);});}
CINEMA_COMPONENTS.Glyph.prototype.getAxisTransform=function(d){var r=this.radius;var rot=this.rotation(d)*RADTODEG;return"translate("+r+") "+"rotate("+rot+" 0 "+r+")";};CINEMA_COMPONENTS.Glyph.prototype.getTextRotation=function(d){var rot=this.rotation(d)*(180/Math.PI);return(rot>90&&rot<270)?180:0;}})();'use strict';(function(){var CINEMA_COMPONENTS={}
if(window.CINEMA_COMPONENTS)
CINEMA_COMPONENTS=window.CINEMA_COMPONENTS;else
window.CINEMA_COMPONENTS=CINEMA_COMPONENTS;if(!CINEMA_COMPONENTS.COMPONENT_INCLUDED)
throw new Error("CINEMA_COMPONENTS ImageSpread module requires that Component"+" module be included. Please make sure that Component module"+" is included BEFORE ImageSpread module");if(!window.d3){throw new Error("CINEMA_COMPONENTS ImageSpread module requires that"+" d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the"+" the ImageSpread module");}
CINEMA_COMPONENTS.IMAGE_SPREAD_INCLUDED=true;CINEMA_COMPONENTS.ImageSpread=function(parent,database){var self=this;CINEMA_COMPONENTS.Component.call(this,parent,database);this.dimensions=this.dimensions.filter(function(d){return(/^FILE/).test(d);});this.hasFileDimensions=this.dimensions.length!=0;this.selection=[];this.currentPage=1;this.dispatch=d3.dispatch('mouseover');d3.select(this.container).classed('IMAGE_SPREAD',true);if(!this.hasFileDimensions){this.noFileWarning=d3.select(this.container).append('div').classed('noFileWarning',true).text("No file information to display");return;}
this.header=d3.select(this.container).append('div').classed('header',true).style('position','absolute').style('width','100%');this.imageContainer=d3.select(this.container).append('div').classed('imageContainer',true).style('position','absolute').style('width','100%').style('overflow-y','auto');this.pageSizeContainer=this.header.append('div').classed('controlPanel pageSize',true);this.pageSizeContainer.append('span').classed('label',true).text("Results Per Page:");this.pageSizeContainer.append('br');this.pageSizeNode=this.pageSizeContainer.append('select').on('change',function(){self.updatePageNav();self.populateResults();}).node();d3.select(this.pageSizeNode).selectAll('option').data([10,25,50,100]).enter().append('option').attr('value',function(d){return d;}).text(function(d){return d;});d3.select(this.pageSizeNode).select('option[value="25"]').attr('selected','true');this.sortContainer=this.header.append('div').classed('controlPanel sort',true);this.sortContainer.append('span').classed('label',true).text("Sort By:");this.sortContainer.append('br');this.sortNode=this.sortContainer.append('select').on('change',function(){self.selection.sort(self.getSortComparator());self.populateResults();}).node();d3.select(this.sortNode).selectAll('option').data(this.db.dimensions.filter(function(d){return!self.db.isStringDimension(d);})).enter().append('option').attr('value',function(d){return d;}).text(function(d){return d;});this.sortOrderContainer=this.header.append('div').classed('controlPanel sortOrder',true);this.sortOrderContainer.append('span').classed('label',true).text("Reverse Sort Order:");this.sortOrderContainer.append('br');this.sortOrderNode=this.sortOrderContainer.append('input').attr('type','checkbox').on('input',function(){self.selection.sort(self.getSortComparator());self.populateResults();}).node();this.imageSizeContainer=this.header.append('div').classed('controlPanel imageSize',true);this.imageSizeContainer.append('span').classed('label',true).text("Image Size: 150px");this.imageSizeContainer.append('br');this.imageSizeNode=this.imageSizeContainer.append('input').attr('type','range').attr('min','100').attr('max','500').on('input',function(){d3.select(self.container).selectAll('.display').style('width',this.value+'px');d3.select(self.container).select('.controlPanel.imageSize .label').text("Image Size: "+this.value+"px");}).node();this.imageSizeNode.value=150;this.updateSize();}
CINEMA_COMPONENTS.ImageSpread.prototype=Object.create(CINEMA_COMPONENTS.Component.prototype);CINEMA_COMPONENTS.ImageSpread.prototype.constructor=CINEMA_COMPONENTS.ImageSpread;CINEMA_COMPONENTS.ImageSpread.prototype.updateSize=function(){CINEMA_COMPONENTS.Component.prototype.updateSize.call(this);if(this.hasFileDimensions){var headerSize=this.header.node().getBoundingClientRect().height;this.imageContainer.style('top',headerSize+'px').style('height',(this.parentRect.height-headerSize)+'px');}};CINEMA_COMPONENTS.ImageSpread.prototype.setSelection=function(indices){this.selection=indices;this.selection.sort(this.getSortComparator());this.updatePageNav();this.populateResults();}
CINEMA_COMPONENTS.ImageSpread.prototype.getSortComparator=function(){var self=this;var d=this.sortNode.value;if(this.sortOrderNode.checked)
return function(a,b){if(self.db.data[a][d]===undefined){return 1;}
if(self.db.data[b][d]===undefined){return-1;}
if(isNaN(self.db.data[a][d])){return 1};if(isNaN(self.db.data[b][d])){return-1};return self.db.data[b][d]-self.db.data[a][d];}
else
return function(a,b){if(self.db.data[a][d]===undefined){return-1;}
if(self.db.data[b][d]===undefined){return 1;}
if(isNaN(self.db.data[a][d])){return-1};if(isNaN(self.db.data[b][d])){return 1};return self.db.data[a][d]-self.db.data[b][d];}}
CINEMA_COMPONENTS.ImageSpread.prototype.populateResults=function(){var self=this;if(this.hasFileDimensions){var pageSize=this.pageSizeNode.value;var pageData=this.selection.slice((this.currentPage-1)*pageSize,Math.min(this.currentPage*pageSize,this.selection.length));var displays=this.imageContainer.selectAll('.dataDisplay').data(pageData);displays.exit().remove();displays.enter().append('div').classed('dataDisplay',true).merge(displays).on('mouseenter',function(d){self.dispatch.call('mouseover',self,d,d3.event);}).on('mouseleave',function(d){self.dispatch.call('mouseover',self,null,d3.event);}).each(function(d){var files=self.dimensions.map(function(dimension){return self.db.data[d][dimension];});var fileDisplays=d3.select(this).selectAll('.fileDisplay').data(files);fileDisplays.exit().remove();var ENTER=fileDisplays.enter().append('div').classed('fileDisplay',true);ENTER.append('div').classed('display',true).style('width',self.imageSizeNode.value+'px');ENTER.append('div').classed('displayLabel',true);var UPDATE=ENTER.merge(fileDisplays).each(function(f,i){d3.select(this).select('.display').html('');if(isValidFiletype(getFileExtension(f)))
d3.select(this).select('.display').classed('image',true).classed('text',false).append('img').attr('src',self.db.directory+'/'+f).attr('width','100%').on('click',self.createModalImg);else
d3.select(this).select('.display').classed('text',true).classed('image',false).append('div').attr('class','resultErrorText').text('Cannot display file: '+f);d3.select(this).select('.displayLabel').text(self.dimensions[i]);});});}};CINEMA_COMPONENTS.ImageSpread.prototype.createModalImg=function(){d3.select('body').append('div').attr('class','modalBackground').on('click',function(){d3.select(this).remove();}).append('img').attr('class','modalImg').attr('src',d3.select(this).attr('src'));}
CINEMA_COMPONENTS.ImageSpread.prototype.updatePageNav=function(){var self=this;d3.select(this.container).select('.pageNavWrapper').remove();var pageSize=this.pageSizeNode.value;if(this.selection.length>pageSize){var numPages=Math.ceil(this.selection.length/pageSize);if(this.currentPage>numPages){this.currentPage=numPages};d3.select(this.container).append('div').classed('pageNavWrapper',true).append('ul').classed('pageNav',true).selectAll('li').data(getPageButtons(numPages,this.currentPage)).enter().append('li').classed('pageButton',true).attr('mode',function(d){return d.page==self.currentPage?'selected':'default';}).text(function(d){return d.text;}).on('click',function(d){if(d3.select(this).attr('mode')!='selected'){self.currentPage=d.page;if(d.do_rebuild){self.updatePageNav();self.populateResults();}
else{d3.select(self.container).select('.pageButton[mode="selected"]').attr('mode','default');d3.select(this).attr('mode','selected');d3.select('.pageReadout').text(self.currentPage+" / "+numPages);self.populateResults();}}});d3.select('.pageNavWrapper').append('div').classed('pageReadout',true).text(this.currentPage+" / "+numPages);}
else{this.currentPage=1;}}
function getPageButtons(numPages,current){if(numPages<=7){var pageData=[];for(var i=0;i<numPages;i++)
pageData.push({text:i+1,page:i+1,do_rebuild:false});return pageData;}
else{var stepSize=Math.pow(10,Math.round(Math.log10(numPages)-1));var pageData=[];if(current!=1){pageData.push({text:"|<",page:1,do_rebuild:true});pageData.push({text:"<",page:current-1,do_rebuild:true});var prevStep=current-stepSize>=1?current-stepSize:current-1;pageData.push({text:prevStep,page:prevStep,do_rebuild:true});}
pageData.push({text:current,page:current,do_rebuild:false});if(current!=numPages){var nextStep=current+stepSize<=numPages?current+stepSize:current+1;pageData.push({text:nextStep,page:nextStep,do_rebuild:true});pageData.push({text:">",page:current+1,do_rebuild:true});pageData.push({text:">|",page:numPages,do_rebuild:true});}
return pageData;}}
function isValidFiletype(type){if(!type)
return false;var validFiletypes=['JPG','JPEG','PNG','GIF'];type=type.trimLeft().trimRight();var index=validFiletypes.indexOf(type.toUpperCase());return(index>=0);}
function getFileExtension(path){return path?path.substr(path.lastIndexOf('.')+1).trimRight():undefined;}})();'use strict';(function(){var CINEMA_COMPONENTS={}
if(window.CINEMA_COMPONENTS)
CINEMA_COMPONENTS=window.CINEMA_COMPONENTS;else
window.CINEMA_COMPONENTS=CINEMA_COMPONENTS;if(!CINEMA_COMPONENTS.COMPONENT_INCLUDED)
throw new Error("CINEMA_COMPONENTS Query module requires that Component"+" module be included. Please make sure that Component module"+" is included BEFORE Query module");if(!window.d3){throw new Error("CINEMA_COMPONENTS Query module requires that"+" d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the"+" the Query module");}
CINEMA_COMPONENTS.QUERY_INCLUDED=true;CINEMA_COMPONENTS.Query=function(parent,database){var self=this;CINEMA_COMPONENTS.Component.call(this,parent,database);this.dimensions=this.dimensions.filter(function(d){return!self.db.isStringDimension(d);});this.results=[];this.custom=new CINEMA_COMPONENTS.ExtraData({},"");this.upper=new CINEMA_COMPONENTS.ExtraData({},"");this.lower=new CINEMA_COMPONENTS.ExtraData({},"");this.dispatch=d3.dispatch('query','customchange');this.scales={};this.dimensions.forEach(function(d){self.scales[d]=d3.scaleLinear().domain([0,100]).range(self.db.dimensionDomains[d]);});d3.select(this.container).classed('QUERY',true);this.queryButton=d3.select(this.container).append('button').classed('queryButton',true).text("Find Similar").on('click',function(){var results=self.db.getSimilar(self.custom.data,self.thresholdNode.value);d3.select(self.readout).text(results.length+" results found!");self.dispatch.call('query',self,results.slice());}).node();this.thresholdLabel=d3.select(this.container).append('span').classed('thresholdLabel',true).text("Threshold:").node();this.thresholdNode=d3.select(this.container).append('input').classed('thresholdInput',true).attr('type','number').attr('max',this.dimensions.length).attr('min',0).attr('step',0.05).on('change',function(){self.updateBounds();self.dispatch.call('customchange',self,[self.custom,self.upper,self.lower]);}).node();this.thresholdNode.value=1.0;this.readout=d3.select(this.container).append('span').classed('readout',true).node();this.rows=d3.select(this.container).selectAll('.inputRow').data(this.dimensions).enter().append('div').classed('inputRow',true).style('position','relative');this.rows.append('span').classed('label',true).style('position','absolute').text(function(d){return d;});this.rows.append('input').attr('type','checkbox').style('position','absolute').on('input',function(d){if(this.checked){var slider=d3.select(this.parentNode).select('input[type="range"]');self.custom.data[d]=self.scales[d](slider.node().value);}
else{delete self.custom.data[d];}
self.updateBounds();self.dispatch.call('customchange',self,[self.custom,self.upper,self.lower]);});this.rows.append('input').attr('type','range').attr('min',0).attr('max',100).attr('step',1).each(function(){this.value=50;}).style('position','absolute').on('input',function(d){var check=d3.select(this.parentNode).select('input[type="checkbox"]');if(!check.node().checked)
check.node().checked=true;self.custom.data[d]=self.scales[d](this.value);self.updateBounds();self.dispatch.call('customchange',self,[self.custom,self.upper,self.lower]);});}
CINEMA_COMPONENTS.Query.prototype=Object.create(CINEMA_COMPONENTS.Component.prototype);CINEMA_COMPONENTS.Query.prototype.constructor=CINEMA_COMPONENTS.Query;CINEMA_COMPONENTS.Query.prototype.updateBounds=function(){var self=this;var threshold=this.thresholdNode.value;var avg=(threshold/d3.keys(this.custom.data).length)*100;this.upper.data={};this.lower.data={};this.dimensions.forEach(function(d){if(self.custom.data[d]!==undefined){var s=self.scales[d];self.lower.data[d]=s(Math.max(s.invert(self.custom.data[d])-avg,0));self.upper.data[d]=s(Math.min(s.invert(self.custom.data[d])+avg,100));}});}})();'use strict';(function(){var CINEMA_COMPONENTS={}
if(window.CINEMA_COMPONENTS)
CINEMA_COMPONENTS=window.CINEMA_COMPONENTS;else
window.CINEMA_COMPONENTS=CINEMA_COMPONENTS;if(!CINEMA_COMPONENTS.COMPONENT_INCLUDED)
throw new Error("CINEMA_COMPONENTS Pcoord module requires that Component"+" module be included. Please make sure that Component module"+" is included BEFORE Pcoord module");if(!window.d3){throw new Error("CINEMA_COMPONENTS Pcoord module requires that"+" d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the"+" the Pcoord module");}
CINEMA_COMPONENTS.PCOORD_INCLUDED=true;CINEMA_COMPONENTS.Pcoord=function(parent,database,filterRegex){if(this.constructor===CINEMA_COMPONENTS.Pcoord)
throw new Error("Cannot instantiate abstract class 'Pcoord'"+" Please use a subclass");var self=this;this.margin=new CINEMA_COMPONENTS.Margin(30,10,10,10);this.NaNMargin;CINEMA_COMPONENTS.Component.call(this,parent,database,filterRegex);this.NaNMargin=this.internalHeight/11;this.selection=d3.range(0,this.db.data.length);this.highlighted=[];this.overlayData=[];this.dispatch=d3.dispatch("selectionchange","mouseover","click","axisorderchange");this.x=d3.scalePoint().domain(this.dimensions).range([0,this.internalWidth]).padding(1);this.y={};this.dimensions.forEach(function(d){if(self.db.isStringDimension(d))
self.y[d]=d3.scalePoint().domain(self.db.dimensionDomains[d]).range([self.internalHeight,0]);else
self.y[d]=d3.scaleLinear().domain(self.db.dimensionDomains[d]).range([self.internalHeight-self.NaNMargin,0]);});this.dragging={};this.axisDragStart=function(d){self.dragging[d]=self.x(d);};this.axisDrag=function(d){self.dragging[d]=Math.min(self.internalWidth,Math.max(0,d3.event.x));self.redrawPaths();var oldDimensions=self.dimensions.slice();self.dimensions.sort(function(a,b){return self.getXPosition(a)-self.getXPosition(b);});if(!arraysEqual(oldDimensions,self.dimensions))
self.dispatch.call('axisorderchange',self,self.dimensions);self.x.domain(self.dimensions);self.axes.attr('transform',function(d){return"translate("+self.getXPosition(d)+")";});};this.axisDragEnd=function(d){delete self.dragging[d];d3.select(this).attr('transform',"translate("+self.x(d)+")");self.redrawPaths();};this.drag=d3.drag().subject(function(d){return{x:self.x(d)};}).on('start',this.axisDragStart).on('drag',this.axisDrag).on('end',this.axisDragEnd);this.brushExtents={}
this.dontUpdateSelectionOnBrush=false;this.axisBrush=function(d){if(d3.event!=null){self.brushExtents[d]=d3.event.selection;if(self.brushExtents[d]!=null&&self.brushExtents[d][0]===self.brushExtents[d][1])
delete self.brushExtents[d];}
if(!self.dontUpdateSelectionOnBrush)
self.updateSelection();}
this.brush=d3.brushY().extent([[-8,0],[8,this.internalHeight]]).on('start',function(){d3.event.sourceEvent.stopPropagation();}).on('start brush',this.axisBrush);d3.select(this.container).classed('PCOORD',true);this.pathContainer=d3.select(this.container).append('div').classed('pathContainer',true).style('position','absolute').style('width',this.parentRect.width+'px').style('height',this.parentRect.height+'px');this.smoothPaths=true;this.axisContainer=d3.select(this.container).append('svg').classed('axisContainer',true).style('position','absolute').attr('viewBox',(-this.margin.right)+' '+(-this.margin.top)+' '+
(this.parentRect.width)+' '+
(this.parentRect.height)).attr('preserveAspectRatio','none').attr('width','100%').attr('height','100%').style('pointer-events','none');this.axes=this.axisContainer.selectAll('.axisGroup').data(this.dimensions).enter().append('g').classed('axisGroup',true).attr('transform',function(d){return"translate("+self.x(d)+")";}).call(this.drag)
this.axes.append('g').classed('axis',true).each(function(d){d3.select(this).call(d3.axisLeft().scale(self.y[d]));if(!self.db.isStringDimension(d))
self.addNaNExtensionToAxis(this);}).append('text').classed('axisTitle',true).style('pointer-events','initial').style('text-anchor','middle').attr('y',-9).text(function(d){return d;});this.axes.append('g').classed('brush',true).each(function(){d3.select(this).call(self.brush);});};CINEMA_COMPONENTS.Pcoord.prototype=Object.create(CINEMA_COMPONENTS.Component.prototype);CINEMA_COMPONENTS.Pcoord.prototype.constructor=CINEMA_COMPONENTS.Pcoord;CINEMA_COMPONENTS.Pcoord.prototype.addNaNExtensionToAxis=function(node){d3.select(node).append('path').attr('class','NaNExtension').attr('d',"M0.5,"+String(this.internalHeight-this.NaNMargin+0.5)+"V"+String(this.internalHeight-0.5));var NaNTick=d3.select(node).append('g').attr('class','NaNExtensionTick').attr('transform',"translate(0,"+String(this.internalHeight-0.5)+")");NaNTick.append('line').attr('x2','-6');NaNTick.append('text').attr('x','-9').attr('dy','0.32em').text('NaN');}
CINEMA_COMPONENTS.Pcoord.prototype.updateSize=function(){var self=this;var oldHeight=this.internalHeight;CINEMA_COMPONENTS.Component.prototype.updateSize.call(this);this.NaNMargin=this.internalHeight/11;this.pathContainer.style('width',this.parentRect.width+'px').style('height',this.parentRect.height+'px');this.x.range([0,this.internalWidth]);this.dimensions.forEach(function(d){self.y[d].range([self.db.isStringDimension(d)?self.internalHeight:self.internalHeight-self.NaNMargin,0]);});this.redrawPaths();this.axisContainer.attr('viewBox',(-this.margin.right)+' '+(-this.margin.top)+' '+
(this.parentRect.width)+' '+
(this.parentRect.height));this.axes.attr("transform",function(d){return"translate("+self.getXPosition(d)+")";});this.axes.each(function(d){d3.select(this).call(d3.axisLeft().scale(self.y[d]));if(!self.db.isStringDimension(d)){d3.select(this).select('path.NaNExtension').attr('d',"M0.5,"+String(self.internalHeight-self.NaNMargin+0.5)+"V"+String(self.internalHeight-0.5));d3.select(this).select('.NaNExtensionTick').attr('transform',"translate(0,"+String(self.internalHeight-0.5)+")");}});this.dontUpdateSelectionOnBrush=true;this.brush.extent([[-8,0],[8,this.internalHeight]]);this.axes.selectAll('g.brush').each(function(d){d3.select(this).call(self.brush);d3.select(this).call(self.brush.move,function(){if(self.brushExtents[d]==null)
return null;return self.brushExtents[d].map(function(i){return i/oldHeight*self.internalHeight;});});});this.dontUpdateSelectionOnBrush=false;}
CINEMA_COMPONENTS.Pcoord.prototype.updateSelection=function(){var self=this;var newSelection=[];this.db.data.forEach(function(d,i){var selected=true;for(var p in self.dimensions){var extent=self.brushExtents[self.dimensions[p]];if(extent){var y=self.getYPosition(self.dimensions[p],d);selected=selected&&extent[0]<=y&&y<=extent[1];if(!selected)
break;}}
if(selected)
newSelection.push(i);});if(!arraysEqual(this.selection,newSelection)){this.selection=newSelection;this.dispatch.call("selectionchange",this,this.selection.slice());this.redrawSelectedPaths();}}
CINEMA_COMPONENTS.Pcoord.prototype.setHighlightedPaths=function(indices){this.highlighted=indices;this.redrawHighlightedPaths();}
CINEMA_COMPONENTS.Pcoord.prototype.setOverlayPaths=function(data){this.overlayData=data;this.redrawOverlayPaths();};CINEMA_COMPONENTS.Pcoord.prototype.redrawPaths=function(){this.redrawSelectedPaths();this.redrawHighlightedPaths();this.redrawOverlayPaths();}
CINEMA_COMPONENTS.Pcoord.prototype.setSelection=function(selection){var ranges={};var self=this;this.dimensions.forEach(function(d){ranges[d]=d3.extent(selection,function(i){return self.getYPosition(d,self.db.data[i]);});});this.axes.selectAll('g.brush').each(function(d){d3.select(this).call(self.brush.move,function(){return[ranges[d][0]-5,ranges[d][1]+5];});});this.axisBrush();}
CINEMA_COMPONENTS.Pcoord.prototype.setAxisOrder=function(order){var self=this;var order=order.filter(function(d){return self.dimensions.includes(d);});this.dimensions.forEach(function(d){if(!order.includes[d])
order.push(d);});this.x.domain(order);self.dimensions.sort(function(a,b){return self.getXPosition(a)-self.getXPosition(b);});this.axes.attr('transform',function(d){return"translate("+self.getXPosition(d)+")";});this.redrawPaths();}
CINEMA_COMPONENTS.Pcoord.prototype.redrawSelectedPaths=function(){throw new Error("Cannot call abstract function 'redrawSelectedPaths()'!"+" Please override function in a subclass");}
CINEMA_COMPONENTS.Pcoord.prototype.redrawHighlightedPaths=function(){throw new Error("Cannot call abstract function 'redrawHighlightedPaths()'!"+" Please override function in a subclass");}
CINEMA_COMPONENTS.Pcoord.prototype.redrawOverlayPaths=function(){throw new Error("Cannot call abstract function 'redrawOverlayPaths()'!"+" Please override function in a subclass");}
CINEMA_COMPONENTS.Pcoord.prototype.getPath=function(d){var self=this;var curveLength=this.smoothPaths?this.internalWidth/this.dimensions.length/3:0;var singleSegmentLength=this.internalWidth/this.dimensions.length/5;var path='';var sections=[];var currentSection=[];this.dimensions.forEach(function(p){if(d[p]!=undefined){currentSection.push(p);}
else if(currentSection.length!=0){sections.push(currentSection.slice());currentSection=[];}});if(currentSection.length>0)
sections.push(currentSection.slice());sections.forEach(function(section){if(section.length==1){var p=section[0];var x=self.getXPosition(p);var y=self.getYPosition(p,d);path+=('M '+(x-singleSegmentLength/2)+' '+y+' L ')+
((x+singleSegmentLength/2)+' '+y);}
else{section.forEach(function(p,i){var x=self.getXPosition(p);var y=self.getYPosition(p,d);if(i==0){path+=('M '+x+' '+y+' C ')+
((x+curveLength)+' '+y+' ');}
else if(i==section.length-1){path+=((x-curveLength)+' '+y+' ')+
(x+' '+y+' ');}
else{path+=((x-curveLength)+' '+y+' ')+
(x+' '+y+' ')+
((x+curveLength)+' '+y+' ');}});}});return path;}
CINEMA_COMPONENTS.Pcoord.prototype.getXPosition=function(d){var v=this.dragging[d];return v==null?this.x(d):v;};CINEMA_COMPONENTS.Pcoord.prototype.getYPosition=function(d,p){if(!this.db.isStringDimension(d)&&isNaN(p[d]))
return this.internalHeight;return this.y[d](p[d]);}
function arraysEqual(a,b){if(a===b)return true;if(a==null||b==null)return false;if(a.length!=b.length)return false;for(var i=0;i<a.length;++i){if(a[i]!==b[i])return false;}
return true;}})();'use strict';(function(){var CINEMA_COMPONENTS={}
if(window.CINEMA_COMPONENTS)
CINEMA_COMPONENTS=window.CINEMA_COMPONENTS;else
window.CINEMA_COMPONENTS=CINEMA_COMPONENTS;if(!CINEMA_COMPONENTS.PCOORD_INCLUDED)
throw new Error("CINEMA_COMPONENTS PcoordSVG Component requires that Pcoord"+" component be included. Please make sure that Pcoord component"+" is included BEFORE PcoordSVG module");CINEMA_COMPONENTS.PCOORDSVG_INCLUDED=true;CINEMA_COMPONENTS.PcoordSVG=function(parent,database,filterRegex){CINEMA_COMPONENTS.Pcoord.call(this,parent,database,filterRegex);d3.select(this.container).classed('SVG',true);this.svg=this.pathContainer.append('svg').style('position','absolute').style('top',this.margin.top+'px').style('left',this.margin.left+'px').attr('width',this.internalWidth+'px').attr('height',this.internalHeight+'px');this.selectedPaths=this.svg.append('g').classed('selectedPaths',true);this.highlightedPaths=this.svg.append('g').classed('highlightedPaths',true);this.overlayPaths=this.svg.append('g').classed('overlayPaths',true);this.redrawPaths();}
CINEMA_COMPONENTS.PcoordSVG.prototype=Object.create(CINEMA_COMPONENTS.Pcoord.prototype);CINEMA_COMPONENTS.PcoordSVG.prototype.constructor=CINEMA_COMPONENTS.PcoordSVG;CINEMA_COMPONENTS.PcoordSVG.prototype.updateSize=function(){CINEMA_COMPONENTS.Pcoord.prototype.updateSize.call(this);this.svg.attr('width',this.internalWidth+'px').attr('height',this.internalHeight+'px');}
CINEMA_COMPONENTS.PcoordSVG.prototype.redrawSelectedPaths=function(){var self=this;var update=this.selectedPaths.selectAll('path').data(this.selection);update.enter().append('path').merge(update).attr('index',function(d){return d;}).attr('d',function(d){return self.getPath(self.db.data[d]);}).on('mouseenter',function(d){self.dispatch.call("mouseover",self,d,d3.event);}).on('mouseleave',function(d){self.dispatch.call("mouseover",self,null,d3.event);}).on('click',function(d){self.dispatch.call("click",self,d);});update.exit().remove();}
CINEMA_COMPONENTS.PcoordSVG.prototype.redrawHighlightedPaths=function(){var self=this;var update=this.highlightedPaths.selectAll('path').data(this.highlighted);update.enter().append('path').merge(update).attr('index',function(d){return d;}).attr('d',function(d){return self.getPath(self.db.data[d]);});update.exit().remove();}
CINEMA_COMPONENTS.PcoordSVG.prototype.redrawOverlayPaths=function(){var self=this;var update=this.overlayPaths.selectAll('path').data(this.overlayData);update.enter().append('path').merge(update).attr('style',function(d){return d.style;}).attr('d',function(d){return self.getPath(d.data);});update.exit().remove();}})();'use strict';(function(){var CINEMA_COMPONENTS={}
if(window.CINEMA_COMPONENTS)
CINEMA_COMPONENTS=window.CINEMA_COMPONENTS;else
window.CINEMA_COMPONENTS=CINEMA_COMPONENTS;if(!CINEMA_COMPONENTS.PCOORD_INCLUDED)
throw new Error("CINEMA_COMPONENTS PcoordCanvas Component requires that Pcoord"+" component be included. Please make sure that Pcoord component"+" is included BEFORE PcoordCanvas module");CINEMA_COMPONENTS.PCOORD_CANVAS_INCLUDED=true;CINEMA_COMPONENTS.PcoordCanvas=function(parent,database,filterRegex){var self=this;CINEMA_COMPONENTS.Pcoord.call(this,parent,database,filterRegex);d3.select(this.container).classed('CANVAS',true);this.selectedCanvas=this.pathContainer.append('canvas').classed('selectedCanvas',true).node();this.highlightedCanvas=this.pathContainer.append('canvas').classed('highlightedCanvas',true).node();this.overlayCanvas=this.pathContainer.append('canvas').classed('overlayCanvas',true).node();this.indexCanvas=this.pathContainer.append('canvas').classed('indexCanvas',true).style('display','none').node();this.pathContainer.selectAll('canvas').style('position','absolute').style('top',this.margin.top+'px').style('left',this.margin.left+'px');this.pixelRatio=(function(){var ctx=document.createElement('canvas').getContext("2d"),dpr=window.devicePixelRatio||1,bsr=ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1;return dpr/bsr;})();this.loading=d3.select(this.container).append('div').classed('loadingIndicator',true).style('display','none').text('Drawing...');this.interval=setInterval(function(self){for(var i=0;i<25;i++){if(self.drawIterator){if(self.drawIterator.next().done){self.drawIterator=undefined;self.loading.style('display','none');}}}},16,this);this.lastMouseMove=null;this.pathContainer.on('mousemove',function(){var x=d3.mouse(self.selectedCanvas)[0]*self.pixelRatio;var y=d3.mouse(self.selectedCanvas)[1]*self.pixelRatio;if(x>=0&&y>=0){var index=getIndexAtPoint(x,y,self.indexCanvas);if(index!=-1){if(self.lastMouseMove!=self.selection[index]){self.lastMouseMove=self.selection[index];self.dispatch.call('mouseover',self,self.selection[index],d3.event);}}
else{if(self.lastMouseMove!==null){self.lastMouseMove=null;self.dispatch.call('mouseover',self,null,d3.event);}}}});this.updateSize();}
CINEMA_COMPONENTS.PcoordCanvas.prototype=Object.create(CINEMA_COMPONENTS.Pcoord.prototype);CINEMA_COMPONENTS.PcoordCanvas.prototype.constructor=CINEMA_COMPONENTS.PcoordCanvas;CINEMA_COMPONENTS.PcoordCanvas.prototype.updateSize=function(){var self=this;CINEMA_COMPONENTS.Pcoord.prototype.updateSize.call(this);this.pathContainer.selectAll('canvas').style('width',this.internalWidth+'px').style('height',this.internalHeight+'px').attr('width',this.internalWidth*this.pixelRatio+'px').attr('height',this.internalHeight*this.pixelRatio+'px').each(function(){this.getContext('2d').scale(self.pixelRatio,self.pixelRatio);});var selectedContext=this.selectedCanvas.getContext('2d');selectedContext.strokeStyle='lightgray';selectedContext.globalAlpha=0.3;selectedContext.lineWidth=2;var highlightedContext=this.highlightedCanvas.getContext('2d');highlightedContext.strokeStyle='lightskyblue';highlightedContext.lineWidth=4;var indexContext=this.indexCanvas.getContext('2d');indexContext.lineWidth=3;this.redrawPaths();}
CINEMA_COMPONENTS.PcoordCanvas.prototype.redrawSelectedPaths=function(){var self=this;var ctx=this.selectedCanvas.getContext('2d');ctx.clearRect(0,0,this.internalWidth,this.internalHeight);var indexCtx=this.indexCanvas.getContext('2d');indexCtx.clearRect(0,0,this.internalWidth,this.internalHeight);this.drawIterator=(function*(queue){self.loading.style('display','initial');var i=0;while(i<queue.length){var path=new Path2D(self.getPath(self.db.data[queue[i]]));ctx.stroke(path);indexCtx.strokeStyle=indexToColor(i);indexCtx.stroke(path);yield++i;}})(this.selection);}
CINEMA_COMPONENTS.PcoordCanvas.prototype.redrawHighlightedPaths=function(){var self=this;var ctx=this.highlightedCanvas.getContext('2d');ctx.clearRect(0,0,this.internalWidth,this.internalHeight);this.highlighted.forEach(function(d){var path=new Path2D(self.getPath(self.db.data[d]));ctx.stroke(path);});}
CINEMA_COMPONENTS.PcoordCanvas.prototype.redrawOverlayPaths=function(){var self=this;var ctx=this.overlayCanvas.getContext('2d');ctx.clearRect(0,0,this.internalWidth,this.internalHeight);this.overlayData.forEach(function(d){ctx.lineWidth=d.style.lineWidth||1;ctx.lineCap=d.style.lineCap||'butt';ctx.lineJoin=d.style.lineJoin||'miter';ctx.miterLimit=d.style.miterLimit||10;ctx.strokeStyle=d.style.strokeStyle||'black';if(d.style.lineDash)
ctx.setLineDash(d.style.lineDash);else
ctx.setLineDash([]);var path=new Path2D(self.getPath(d.data));ctx.stroke(path);})}
CINEMA_COMPONENTS.PcoordCanvas.prototype.destroy=function(){clearInterval(this.interval);CINEMA_COMPONENTS.Component.prototype.destroy.call(this);}
var getIndexAtPoint=function(x,y,canvas){var colorData=canvas.getContext('2d').getImageData(x-1,y-1,3,3).data;var indices=[];for(var i=0;i<colorData.length/4;i++){indices.push(colorToIndex(colorData.slice(i*4,i*4+3)));}
indices.sort();var matched=-1;var count=0;var counting=-1;for(var i=0;i<indices.length;i++){if(counting!=indices[i]){count=1;counting=indices[i];}
else{count++;if(count==5){matched=counting;break;}}}
return matched;}
var indexToColor=function(i){if(i>256*256*256){return'rgb(255,255,255)';}
i++;var b=Math.floor(i/256/256);var g=Math.floor((i-b*256*256)/256);var r=(i-b*256*256-g*256);return'rgb('+r+','+g+','+b+')';}
var colorToIndex=function(rgb){return(rgb[0]+rgb[1]*256+rgb[2]*256*256)-1;}})();'use strict';(function(){var CINEMA_COMPONENTS={}
if(window.CINEMA_COMPONENTS)
CINEMA_COMPONENTS=window.CINEMA_COMPONENTS;else
window.CINEMA_COMPONENTS=CINEMA_COMPONENTS;if(!CINEMA_COMPONENTS.COMPONENT_INCLUDED)
throw new Error("CINEMA_COMPONENTS ScatterPlot module requires that Component"+" module be included. Please make sure that Component module"+" is included BEFORE ScatterPlot module");if(!window.d3){throw new Error("CINEMA_COMPONENTS ScatterPlot module requires that"+" d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the"+" the ScatterPlot module");}
CINEMA_COMPONENTS.SCATTER_PLOT_INCLUDED=true;CINEMA_COMPONENTS.ScatterPlot=function(parent,database,filterRegex){var self=this;this.margin=new CINEMA_COMPONENTS.Margin(25,25,60,150);CINEMA_COMPONENTS.Component.call(this,parent,database,filterRegex);this.selection=[];this.highlighted=[];this.overlayData=[];this.xDimension=this.dimensions[0];this.yDimension=this.dimensions[1];this.dispatch=d3.dispatch("mouseover",'xchanged','ychanged');this.x=(this.db.isStringDimension(this.xDimension)?d3.scalePoint():d3.scaleLinear()).domain(this.db.dimensionDomains[this.xDimension]).range([0,this.internalWidth]);this.y=(this.db.isStringDimension(this.yDimension)?d3.scalePoint():d3.scaleLinear()).domain(this.db.dimensionDomains[this.yDimension]).range([this.internalHeight,0]);d3.select(this.container).classed('SCATTER_PLOT',true);this.pointContainer=d3.select(this.container).append('div').classed('pointContainer',true).style('position','absolute').style('top',this.margin.top+'px').style('right',this.margin.right+'px').style('bottom',this.margin.bottom+'px').style('left',this.margin.left+'px').style('width',this.internalWidth+'px').style('height',this.internalHeight+'px');this.xSelect=d3.select(this.container).append('select').classed('dimensionSelect x',true).style('position','absolute').node();this.ySelect=d3.select(this.container).append('select').classed('dimensionSelect y',true).style('position','absolute').node();d3.select(this.xSelect).selectAll('option').data(this.dimensions).enter().append('option').attr('value',function(d){return d;}).text(function(d){return d;});d3.select(this.xSelect).node().value=this.xDimension;d3.select(this.ySelect).selectAll('option').data(this.dimensions).enter().append('option').attr('value',function(d){return d;}).text(function(d){return d;});d3.select(this.ySelect).node().value=this.yDimension;d3.select(this.xSelect).on('input',function(){self.xDimension=this.value;self.x=(self.db.isStringDimension(self.xDimension)?d3.scalePoint():d3.scaleLinear()).domain(self.db.dimensionDomains[self.xDimension]).range([0,self.internalWidth]);self.xAxisContainer.select('.axis').call(d3.axisBottom().scale(self.x));self.dispatch.call('xchanged',self,self.xDimension);self.redrawPoints();});d3.select(this.ySelect).on('input',function(){self.yDimension=this.value;self.y=(self.db.isStringDimension(self.yDimension)?d3.scalePoint():d3.scaleLinear()).domain(self.db.dimensionDomains[self.yDimension]).range([self.internalHeight,0]);self.yAxisContainer.select('.axis').call(d3.axisLeft().scale(self.y));self.dispatch.call('ychanged',self,self.yDimension);self.redrawPoints();});this.warningReadout=d3.select(this.container).append('div').classed('warningReadout',true).style('position','absolute');this.xAxisContainer=d3.select(this.container).append('svg').classed('axisContainer x',true).style('position','absolute').style('width',this.internalWidth+'px').style('height',25+'px').style('top',this.margin.top+this.internalHeight+'px').style('left',this.margin.left+'px');this.yAxisContainer=d3.select(this.container).append('svg').classed('axisContainer y',true).style('position','absolute').style('width',50+'px').style('height',this.internalHeight+'px').style('left',(this.margin.left-50)+'px').style('top',this.margin.top+'px');this.xAxisContainer.append('g').classed('axis',true).call(d3.axisBottom().scale(this.x));this.yAxisContainer.append('g').classed('axis',true).attr('transform','translate(50)').call(d3.axisLeft().scale(this.y));};CINEMA_COMPONENTS.ScatterPlot.prototype=Object.create(CINEMA_COMPONENTS.Component.prototype);CINEMA_COMPONENTS.ScatterPlot.prototype.constructor=CINEMA_COMPONENTS.ScatterPlot;CINEMA_COMPONENTS.ScatterPlot.prototype.updateSize=function(){CINEMA_COMPONENTS.Component.prototype.updateSize.call(this);this.pointContainer.style('width',this.internalWidth+'px').style('height',this.internalHeight+'px');this.x.range([0,this.internalWidth]);this.y.range([this.internalHeight,0]);this.xAxisContainer.style('top',this.margin.top+this.internalHeight+'px').style('width',this.internalWidth+'px').select('.axis').call(d3.axisBottom().scale(this.x));this.yAxisContainer.style('height',this.internalHeight+'px').select('.axis').call(d3.axisLeft().scale(this.y));this.redrawPoints();}
CINEMA_COMPONENTS.ScatterPlot.prototype.redrawPoints=function(){this.redrawSelectedPoints();this.redrawHighlightedPoints();this.redrawOverlayPoints();}
CINEMA_COMPONENTS.ScatterPlot.prototype.getPlottablePoints=function(selection){var self=this;return selection.filter(function(d){var xCoord=self.x(self.db.data[d][self.xDimension]);var yCoord=self.y(self.db.data[d][self.yDimension]);return!(isNaN(xCoord)||isNaN(yCoord));});}
CINEMA_COMPONENTS.ScatterPlot.prototype.setSelection=function(selection){this.selection=selection;this.redrawSelectedPoints();}
CINEMA_COMPONENTS.ScatterPlot.prototype.setHighlightedPoints=function(indices){this.highlighted=indices;this.redrawHighlightedPoints();}
CINEMA_COMPONENTS.ScatterPlot.prototype.setOverlayPoints=function(data){this.overlayData=data;this.redrawOverlayPaths();};CINEMA_COMPONENTS.ScatterPlot.prototype.redrawSelectedPoints=function(){throw new Error("Cannot call abstract function 'redrawSelectedPoints()'!"+" Please override function in a subclass");}
CINEMA_COMPONENTS.ScatterPlot.prototype.redrawHighlightedPoints=function(){throw new Error("Cannot call abstract function 'redrawHighlightedPoints()'!"+" Please override function in a subclass");}
CINEMA_COMPONENTS.ScatterPlot.prototype.redrawOverlayPoints=function(){throw new Error("Cannot call abstract function 'redrawOverlayPoints()'!"+" Please override function in a subclass");}})();'use strict';(function(){var CINEMA_COMPONENTS={}
if(window.CINEMA_COMPONENTS)
CINEMA_COMPONENTS=window.CINEMA_COMPONENTS;else
window.CINEMA_COMPONENTS=CINEMA_COMPONENTS;if(!CINEMA_COMPONENTS.SCATTER_PLOT_INCLUDED)
throw new Error("CINEMA_COMPONENTS ScatterPlotSVG Component requires that ScatterPlot"+" component be included. Please make sure that ScatterPlot component"+" is included BEFORE ScatterPlotSVG module");CINEMA_COMPONENTS.SCATTER_PLOT_SVG_INCLUDED=true;CINEMA_COMPONENTS.ScatterPlotSVG=function(parent,database,filterRegex){CINEMA_COMPONENTS.ScatterPlot.call(this,parent,database,filterRegex);d3.select(this.container).classed('SVG',true);this.svg=this.pointContainer.append('svg').style('position','absolute').attr('viewBox','0 0 '+this.internalWidth+' '+this.internalHeight).attr('preserveAspectRatio','none').attr('width','100%').attr('height','100%');this.selectedPoints=this.svg.append('g').classed('selectedPoints',true);this.highlightedPoints=this.svg.append('g').classed('highlightedPoints',true);this.overlayPoints=this.svg.append('g').classed('overlayPoints',true);this.redrawPoints();}
CINEMA_COMPONENTS.ScatterPlotSVG.prototype=Object.create(CINEMA_COMPONENTS.ScatterPlot.prototype);CINEMA_COMPONENTS.ScatterPlotSVG.prototype.constructor=CINEMA_COMPONENTS.ScatterPlotSVG;CINEMA_COMPONENTS.ScatterPlotSVG.prototype.updateSize=function(){CINEMA_COMPONENTS.ScatterPlot.prototype.updateSize.call(this);this.svg.attr('viewBox','0 0 '+this.internalWidth+' '+this.internalHeight);}
CINEMA_COMPONENTS.ScatterPlotSVG.prototype.redrawSelectedPoints=function(){var self=this;var plottable=this.getPlottablePoints(this.selection);if(plottable.length<this.selection.length)
this.warningReadout.text((this.selection.length-plottable.length)+" point(s) could not be plotted (because they contain NaN or undefined values).");else
this.warningReadout.text('');var update=this.selectedPoints.selectAll('circle').data(plottable);update.enter().append('circle').attr('r','6').merge(update).attr('index',function(d){return d;}).attr('cx',function(d){return self.x(self.db.data[d][self.xDimension]);}).attr('cy',function(d){return self.y(self.db.data[d][self.yDimension]);}).on('mouseenter',function(d){self.dispatch.call('mouseover',self,d,d3.event);}).on('mouseleave',function(d){self.dispatch.call('mouseover',self,null,d3.event);});update.exit().remove();}
CINEMA_COMPONENTS.ScatterPlotSVG.prototype.redrawHighlightedPoints=function(){var self=this;var update=this.highlightedPoints.selectAll('circle').data(this.getPlottablePoints(this.highlighted));update.enter().append('circle').attr('r','10').merge(update).attr('index',function(d){return d;}).attr('cx',function(d){return self.x(self.db.data[d][self.xDimension]);}).attr('cy',function(d){return self.y(self.db.data[d][self.yDimension]);});update.exit().remove();}
CINEMA_COMPONENTS.ScatterPlotSVG.prototype.redrawOverlayPoints=function(){var self=this;var update=this.overlayPoints.selectAll('circle').data(this.overlayData);update.enter().append('circle').attr('r','5').merge(update).attr('cx',function(d){return self.x(d.data[self.xDimension]);}).attr('cy',function(d){return self.y(d.data[self.yDimension]);}).attr('style',function(d){return d.style;});update.exit().remove();}})();'use strict';(function(){var CINEMA_COMPONENTS={}
if(window.CINEMA_COMPONENTS)
CINEMA_COMPONENTS=window.CINEMA_COMPONENTS;else
window.CINEMA_COMPONENTS=CINEMA_COMPONENTS;if(!CINEMA_COMPONENTS.SCATTER_PLOT_INCLUDED)
throw new Error("CINEMA_COMPONENTS ScatterPlotCanvas Component requires that ScatterPlot"+" component be included. Please make sure that ScatterPlot component"+" is included BEFORE ScatterPlotCanvas module");CINEMA_COMPONENTS.SCATTER_PLOT_CANVAS_INCLUDED=true;CINEMA_COMPONENTS.ScatterPlotCanvas=function(parent,database,filterRegex){var self=this;CINEMA_COMPONENTS.ScatterPlot.call(this,parent,database,filterRegex);d3.select(this.container).classed('CANVAS',true);this.plottablePoints=[];this.selectedCanvas=this.pointContainer.append('canvas').classed('selectedCanvas',true).node();this.highlightedCanvas=this.pointContainer.append('canvas').classed('highlightedCanvas',true).node();this.overlayCanvas=this.pointContainer.append('canvas').classed('overlayCanvas',true).node();this.indexCanvas=this.pointContainer.append('canvas').classed('indexCanvas',true).style('display','none').node();this.pointContainer.selectAll('canvas').style('position','absolute');this.pixelRatio=(function(){var ctx=document.createElement('canvas').getContext("2d"),dpr=window.devicePixelRatio||1,bsr=ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1;return dpr/bsr;})();this.loading=d3.select(this.container).append('div').classed('loadingIndicator',true).style('display','none').text('Drawing...');this.interval=setInterval(function(self){for(var i=0;i<25;i++){if(self.drawIterator){if(self.drawIterator.next().done){self.drawIterator=undefined;self.loading.style('display','none');}}}},16,this);this.lastMouseMove=null;this.pointContainer.on('mousemove',function(){var x=d3.mouse(self.selectedCanvas)[0]*self.pixelRatio;var y=d3.mouse(self.selectedCanvas)[1]*self.pixelRatio;if(x>=0&&y>=0){var index=getIndexAtPoint(x,y,self.indexCanvas);if(index!=-1){if(self.lastMouseMove!=self.plottablePoints[index]){self.lastMouseMove=self.plottablePoints[index];self.dispatch.call('mouseover',self,self.plottablePoints[index],d3.event);}}
else{if(self.lastMouseMove!==null){self.lastMouseMove=null;self.dispatch.call('mouseover',self,null,d3.event);}}}});this.updateSize();}
CINEMA_COMPONENTS.ScatterPlotCanvas.prototype=Object.create(CINEMA_COMPONENTS.ScatterPlot.prototype);CINEMA_COMPONENTS.ScatterPlotCanvas.prototype.constructor=CINEMA_COMPONENTS.ScatterPlotCanvas;CINEMA_COMPONENTS.ScatterPlotCanvas.prototype.updateSize=function(){var self=this;CINEMA_COMPONENTS.ScatterPlot.prototype.updateSize.call(this);this.pointContainer.selectAll('canvas').style('width',this.internalWidth+'px').style('height',this.internalHeight+'px').attr('width',this.internalWidth*this.pixelRatio+'px').attr('height',this.internalHeight*this.pixelRatio+'px').each(function(){this.getContext('2d').scale(self.pixelRatio,self.pixelRatio);});var selectedContext=this.selectedCanvas.getContext('2d');selectedContext.fillStyle='rgba(82, 137, 163, 0.521)';selectedContext.strokeStyle='rgb(69, 121, 153)';selectedContext.lineWidth=2;var highlightedContext=this.highlightedCanvas.getContext('2d');highlightedContext.fillStyle='rgb(252, 127, 127)';highlightedContext.strokeStyle='rgb(153, 80, 80)';highlightedContext.lineWidth=3;this.redrawPoints();}
CINEMA_COMPONENTS.ScatterPlotCanvas.prototype.redrawSelectedPoints=function(){var self=this;this.plottablePoints=this.getPlottablePoints(this.selection);if(this.plottablePoints.length<this.selection.length)
this.warningReadout.text((this.selection.length-this.plottablePoints.length)+" point(s) could not be plotted (because they contain NaN or undefined values).");else
this.warningReadout.text('');var ctx=this.selectedCanvas.getContext('2d');ctx.clearRect(0,0,this.internalWidth,this.internalHeight);var indexCtx=this.indexCanvas.getContext('2d');indexCtx.clearRect(0,0,this.internalWidth,this.internalHeight);this.drawIterator=(function*(queue){self.loading.style('display','initial');var i=0;while(i<queue.length){var x=self.x(self.db.data[queue[i]][self.xDimension]);var y=self.y(self.db.data[queue[i]][self.yDimension]);ctx.beginPath();ctx.arc(x,y,6,0,2*Math.PI);ctx.fill();ctx.stroke();indexCtx.fillStyle=indexToColor(i);indexCtx.beginPath();indexCtx.arc(x,y,10,0,2*Math.PI);indexCtx.fill();yield++i;}})(this.plottablePoints);}
CINEMA_COMPONENTS.ScatterPlotCanvas.prototype.redrawHighlightedPoints=function(){var self=this;var plottable=this.getPlottablePoints(this.highlighted);var ctx=this.highlightedCanvas.getContext('2d');ctx.clearRect(0,0,this.internalWidth,this.internalHeight);plottable.forEach(function(d){var x=self.x(self.db.data[d][self.xDimension]);var y=self.y(self.db.data[d][self.yDimension]);ctx.beginPath();ctx.arc(x,y,10,0,2*Math.PI);ctx.fill();ctx.stroke();});}
CINEMA_COMPONENTS.ScatterPlotCanvas.prototype.redrawOverlayPoints=function(){var self=this;var ctx=this.overlayCanvas.getContext('2d');ctx.clearRect(0,0,this.internalWidth,this.internalHeight);this.overlayData.forEach(function(d){ctx.lineWidth=d.style.lineWidth||0;ctx.lineCap=d.style.lineCap||'butt';ctx.lineJoin=d.style.lineJoin||'miter';ctx.miterLimit=d.style.miterLimit||10;ctx.strokeStyle=d.style.strokeStyle||'black';ctx.fillStyle=d.style.fillStyle||'black';if(d.style.lineDash)
ctx.setLineDash(d.style.lineDash);else
ctx.setLineDash([]);var x=self.x(d.data[self.xDimension]);var y=self.y(d.data[self.yDimension]);ctx.beginPath();ctx.arc(x,y,(d.style.r||6),0,2*Math.PI);ctx.fill();ctx.stroke();});}
var getIndexAtPoint=function(x,y,canvas){var colorData=canvas.getContext('2d').getImageData(x-1,y-1,3,3).data;var indices=[];for(var i=0;i<colorData.length/4;i++){indices.push(colorToIndex(colorData.slice(i*4,i*4+3)));}
indices.sort();var matched=-1;var count=0;var counting=-1;for(var i=0;i<indices.length;i++){if(counting!=indices[i]){count=1;counting=indices[i];}
else{count++;if(count==5){matched=counting;break;}}}
return matched;}
var indexToColor=function(i){if(i>256*256*256){return'rgb(255,255,255)';}
i++;var b=Math.floor(i/256/256);var g=Math.floor((i-b*256*256)/256);var r=(i-b*256*256-g*256);return'rgb('+r+','+g+','+b+')';}
var colorToIndex=function(rgb){return(rgb[0]+rgb[1]*256+rgb[2]*256*256)-1;}})();